<!doctype html>
<html>
<head>
    <title>Metaproject Window Manager</title>

    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/metaproject.css"/>

    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap-dropdown.js"></script>
    <script type="text/javascript" src="../js/modernizr.js"></script>
    <script type="text/javascript" src="../js/knockout-2.0.0.js"></script>
    <script type="text/javascript" src="../js/metaproject.js"></script>
</head>
<body>
<script type="text/html" id="hello-window">
    <div class="modal-footer">
        <a href="#" class="btn btn-primary" data-bind="click: new_window">Open New Window</a>
    </div>
</script>

<script type="text/html" id="new-window">
    <p>Hello</p>
    <p>A new window here</p>
</script>

<div data-bind="if: windows().length == 0">
    <p>You're out of windows! <a data-bind="click: hello_window">Click here</a></p>
</div>
<div id="window-manager" data-bind="foreach: windows">

    <div class="modal" style="position: relative; top: auto; left: auto; margin: 0 auto; z-index: 1">
        <div class="modal-header">
            <a class="close" data-bind="click: $parent.close">&times;</a>
            <h3 data-bind="text: title">Modal header</h3>
        </div>
        <div class="modal-body" data-bind="template: template">
            <p>One fine bodyâ€¦</p>
        </div>

    </div>

</div>

<script type="text/javascript">


    var windowManager = new WindowManager();


    windowManager.hello_window = function() {
        var helloWindow = new Window({ template: 'hello-window', title: 'Hello Window'});

        helloWindow.new_window = function() {
            windowManager.open(new Window({ title: 'Another Window', template: 'new-window' } ));
        };

        windowManager.open(helloWindow);
    }

    ko.applyBindings(windowManager);

    function Window(data) {
        var self = this;

        self.template = ko.observable(data.template);
        self.title = ko.observable(data.title || 'Untitled Window');

    }

    function WindowManager() {
        var self = this;
        self.windows = ko.observableArray();

        self.open = function(window) {
            window._wm = self;
            self.windows.push(window);
        };

        self.close = function(window) {
            console.log(window);
            self.windows.remove(window);
        };
    }
</script>
</body>
</html>